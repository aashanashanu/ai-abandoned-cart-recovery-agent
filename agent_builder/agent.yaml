name: AI Abandoned Cart Recovery Agent for an E-commerce Platform
version: 1.0

purpose: >
  Detect abandoned carts, diagnose the root cause using correlated telemetry in Elasticsearch,
  learn from prior recovery outcomes, choose the best recovery action, and trigger automation.

tools:
  - name: detect_abandoned_carts
    description: Identify carts likely abandoned given a lookback window and abandonment threshold.
  - name: analyze_abandonment
    description: Correlate cart/checkout/payment/performance data for a cart_id and output a diagnosis.
  - name: get_customer_profile
    description: Retrieve contact + segment + preferences for a customer.
  - name: find_similar_abandonments
    description: Search recovery_history for similar cases and summarize action success rates.
  - name: decide_recovery_action
    description: Choose the best recovery action (discount/free shipping/reminder/payment retry) with rationale.
  - name: trigger_recovery_action
    description: Trigger a mock email/push workflow.
  - name: record_recovery_attempt
    description: Persist the attempted action and diagnosis into recovery_history.

multi_step_workflow:
  - step: 1
    name: Detect abandoned carts
    instruction: >
      Call detect_abandoned_carts. Prefer high-value carts first. Return a short list of candidates.
    tool: detect_abandoned_carts
    input_schema:
      lookback_minutes: 1440
      abandonment_minutes: 30
      max_candidates: 20

  - step: 2
    name: Diagnose root cause (correlation)
    instruction: >
      For each candidate cart_id, call analyze_abandonment and extract the most likely root cause.
      Root causes must be one of: payment_failure, performance_latency, checkout_friction, pricing_shipping, unknown.
    tool: analyze_abandonment

  - step: 3
    name: Enrich with customer profile
    instruction: >
      Call get_customer_profile for the cart's customer_id. Use channel preferences and segment.
    tool: get_customer_profile

  - step: 4
    name: Learn from similar historical recoveries
    instruction: >
      Call find_similar_abandonments using diagnosis + segment + cart_value (+ payment_method if known).
      Summarize which action has the highest success rate.
    tool: find_similar_abandonments

  - step: 5
    name: Decide recovery action
    instruction: >
      Call decide_recovery_action with diagnosis + customer profile + similarity stats.
      Output: action type and parameters plus a brief rationale.
    tool: decide_recovery_action

  - step: 6
    name: Trigger automation
    instruction: >
      Call trigger_recovery_action. Prefer the customer's preferred channel when possible.
    tool: trigger_recovery_action

  - step: 7
    name: Record attempt
    instruction: >
      Call record_recovery_attempt so future runs can learn from outcomes.
    tool: record_recovery_attempt

notes:
  - The agent should never send a discount to customers marked as high_risk_fraud.
  - If payment failure is retryable, prefer payment_retry before discounts.
  - If session latency is high, prefer a simple reminder and offer support rather than a discount.
